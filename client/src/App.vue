<script setup>
import { ArrowLeftEndOnRectangleIcon, FireIcon, UserCircleIcon, UserGroupIcon } from '@heroicons/vue/24/outline';
import { useRouter } from 'vue-router';

const router = useRouter();

const logout = async () => {
  try {
    await fetch('http://localhost:8080/api/auth/logout', {
      method: 'POST',
      credentials: 'include' // Assurez-vous d'inclure les credentials si nécessaire
    });
    localStorage.clear(); // Effacez toutes les données locales si nécessaire
    window.location = "/login"; // Redirigez l'utilisateur vers la page /logout après la déconnexion
  } catch (error) {
    console.error('Error logging out:', error);
  }
};

const userId = localStorage.getItem('userId'); 
const firstName = localStorage.getItem('firstName'); 
</script>

<template>
  <div id="app">
    <header class="container">
      <router-link to="/" class="logo">

        <svg width="155" height="25" viewBox="0 0 155 25" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M0.656 24.5V2.1H10.352C12.3573 2.1 14.0853 2.43067 15.536 3.092C16.9867 3.732 18.1067 4.66 18.896 5.876C19.6853 7.092 20.08 8.54267 20.08 10.228C20.08 11.892 19.6853 13.332 18.896 14.548C18.1067 15.764 16.9867 16.7027 15.536 17.364C14.0853 18.004 12.3573 18.324 10.352 18.324H3.536L5.84 15.988V24.5H0.656ZM5.84 16.564L3.536 14.1H10.064C11.664 14.1 12.8587 13.7587 13.648 13.076C14.4373 12.3933 14.832 11.444 14.832 10.228C14.832 8.99067 14.4373 8.03067 13.648 7.348C12.8587 6.66533 11.664 6.324 10.064 6.324H3.536L5.84 3.86V16.564ZM31.9418 24.756C29.9791 24.756 28.2511 24.372 26.7578 23.604C25.2858 22.836 24.1444 21.7907 23.3338 20.468C22.5231 19.124 22.1178 17.5987 22.1178 15.892C22.1178 14.164 22.5124 12.6387 23.3018 11.316C24.1124 9.972 25.2111 8.92667 26.5978 8.18C27.9844 7.412 29.5524 7.028 31.3018 7.028C32.9871 7.028 34.5018 7.39067 35.8458 8.116C37.2111 8.82 38.2884 9.844 39.0778 11.188C39.8671 12.5107 40.2618 14.1 40.2618 15.956C40.2618 16.148 40.2511 16.372 40.2298 16.628C40.2084 16.8627 40.1871 17.0867 40.1658 17.3H26.1818V14.388H37.5417L35.6218 15.252C35.6218 14.356 35.4404 13.5773 35.0778 12.916C34.7151 12.2547 34.2138 11.7427 33.5738 11.38C32.9338 10.996 32.1871 10.804 31.3338 10.804C30.4804 10.804 29.7231 10.996 29.0618 11.38C28.4218 11.7427 27.9204 12.2653 27.5578 12.948C27.1951 13.6093 27.0138 14.3987 27.0138 15.316V16.084C27.0138 17.0227 27.2164 17.8547 27.6218 18.58C28.0484 19.284 28.6351 19.828 29.3818 20.212C30.1498 20.5747 31.0458 20.756 32.0698 20.756C32.9871 20.756 33.7871 20.6173 34.4698 20.34C35.1738 20.0627 35.8138 19.6467 36.3898 19.092L39.0458 21.972C38.2564 22.868 37.2644 23.5613 36.0698 24.052C34.8751 24.5213 33.4991 24.756 31.9418 24.756ZM50.6253 24.756C48.5986 24.756 47.0199 24.244 45.8893 23.22C44.7586 22.1747 44.1933 20.628 44.1933 18.58V3.476H49.1853V18.516C49.1853 19.2413 49.3773 19.8067 49.7613 20.212C50.1453 20.596 50.6679 20.788 51.3293 20.788C52.1186 20.788 52.7906 20.5747 53.3453 20.148L54.6893 23.668C54.1773 24.0307 53.5586 24.308 52.8333 24.5C52.1293 24.6707 51.3933 24.756 50.6253 24.756ZM41.5373 11.508V7.668H53.4733V11.508H41.5373ZM79.5395 7.028C80.9048 7.028 82.1102 7.30533 83.1555 7.86C84.2222 8.39333 85.0542 9.22533 85.6515 10.356C86.2702 11.4653 86.5795 12.8947 86.5795 14.644V24.5H81.5875V15.412C81.5875 14.0253 81.2995 13.0013 80.7235 12.34C80.1475 11.6787 79.3368 11.348 78.2915 11.348C77.5662 11.348 76.9155 11.5187 76.3395 11.86C75.7635 12.18 75.3155 12.6707 74.9955 13.332C74.6755 13.9933 74.5155 14.836 74.5155 15.86V24.5H69.5235V15.412C69.5235 14.0253 69.2355 13.0013 68.6595 12.34C68.1048 11.6787 67.3048 11.348 66.2595 11.348C65.5342 11.348 64.8835 11.5187 64.3075 11.86C63.7315 12.18 63.2835 12.6707 62.9635 13.332C62.6435 13.9933 62.4835 14.836 62.4835 15.86V24.5H57.4915V7.284H62.2595V11.988L61.3635 10.612C61.9608 9.43867 62.8035 8.55333 63.8915 7.956C65.0008 7.33733 66.2595 7.028 67.6675 7.028C69.2462 7.028 70.6222 7.43333 71.7955 8.244C72.9902 9.03333 73.7795 10.2493 74.1635 11.892L72.4035 11.412C72.9795 10.068 73.8968 9.00133 75.1555 8.212C76.4355 7.42267 77.8968 7.028 79.5395 7.028ZM101.614 24.5V21.14L101.294 20.404V14.388C101.294 13.3213 100.963 12.4893 100.302 11.892C99.662 11.2947 98.67 10.996 97.326 10.996C96.4087 10.996 95.502 11.1453 94.606 11.444C93.7313 11.7213 92.9847 12.1053 92.366 12.596L90.574 9.108C91.5127 8.44667 92.6433 7.93467 93.966 7.572C95.2887 7.20933 96.6327 7.028 97.998 7.028C100.622 7.028 102.659 7.64667 104.11 8.884C105.561 10.1213 106.286 12.052 106.286 14.676V24.5H101.614ZM96.366 24.756C95.022 24.756 93.87 24.532 92.91 24.084C91.95 23.6147 91.214 22.9853 90.702 22.196C90.19 21.4067 89.934 20.5213 89.934 19.54C89.934 18.516 90.1793 17.62 90.67 16.852C91.182 16.084 91.982 15.4867 93.07 15.06C94.158 14.612 95.5767 14.388 97.326 14.388H101.902V17.3H97.87C96.6967 17.3 95.886 17.492 95.438 17.876C95.0113 18.26 94.798 18.74 94.798 19.316C94.798 19.956 95.0433 20.468 95.534 20.852C96.046 21.2147 96.7393 21.396 97.614 21.396C98.446 21.396 99.1927 21.204 99.854 20.82C100.515 20.4147 100.995 19.828 101.294 19.06L102.062 21.364C101.699 22.4733 101.038 23.316 100.078 23.892C99.118 24.468 97.8807 24.756 96.366 24.756ZM116.596 24.756C115.124 24.756 113.705 24.5853 112.34 24.244C110.996 23.8813 109.929 23.4333 109.14 22.9L110.804 19.316C111.593 19.8067 112.521 20.212 113.588 20.532C114.676 20.8307 115.743 20.98 116.788 20.98C117.94 20.98 118.751 20.8413 119.22 20.564C119.711 20.2867 119.956 19.9027 119.956 19.412C119.956 19.0067 119.764 18.708 119.38 18.516C119.017 18.3027 118.527 18.1427 117.908 18.036C117.289 17.9293 116.607 17.8227 115.86 17.716C115.135 17.6093 114.399 17.4707 113.652 17.3C112.905 17.108 112.223 16.8307 111.604 16.468C110.985 16.1053 110.484 15.6147 110.1 14.996C109.737 14.3773 109.556 13.5773 109.556 12.596C109.556 11.508 109.865 10.548 110.484 9.716C111.124 8.884 112.041 8.23333 113.236 7.764C114.431 7.27333 115.86 7.028 117.524 7.028C118.697 7.028 119.892 7.156 121.108 7.412C122.324 7.668 123.337 8.04133 124.148 8.532L122.484 12.084C121.652 11.5933 120.809 11.2627 119.956 11.092C119.124 10.9 118.313 10.804 117.524 10.804C116.415 10.804 115.604 10.9533 115.092 11.252C114.58 11.5507 114.324 11.9347 114.324 12.404C114.324 12.8307 114.505 13.1507 114.868 13.364C115.252 13.5773 115.753 13.748 116.372 13.876C116.991 14.004 117.663 14.1213 118.388 14.228C119.135 14.3133 119.881 14.452 120.628 14.644C121.375 14.836 122.047 15.1133 122.644 15.476C123.263 15.8173 123.764 16.2973 124.148 16.916C124.532 17.5133 124.724 18.3027 124.724 19.284C124.724 20.3507 124.404 21.3 123.764 22.132C123.124 22.9427 122.196 23.5827 120.98 24.052C119.785 24.5213 118.324 24.756 116.596 24.756ZM138.268 7.028C139.633 7.028 140.849 7.30533 141.916 7.86C143.004 8.39333 143.857 9.22533 144.476 10.356C145.095 11.4653 145.404 12.8947 145.404 14.644V24.5H140.412V15.412C140.412 14.0253 140.103 13.0013 139.484 12.34C138.887 11.6787 138.033 11.348 136.924 11.348C136.135 11.348 135.42 11.5187 134.78 11.86C134.161 12.18 133.671 12.6813 133.308 13.364C132.967 14.0467 132.796 14.9213 132.796 15.988V24.5H127.804V0.755999H132.796V12.052L131.676 10.612C132.295 9.46 133.18 8.57467 134.332 7.956C135.484 7.33733 136.796 7.028 138.268 7.028ZM151.817 24.756C150.964 24.756 150.228 24.468 149.609 23.892C149.012 23.2947 148.713 22.5373 148.713 21.62C148.713 20.7027 149.012 19.9667 149.609 19.412C150.228 18.836 150.964 18.548 151.817 18.548C152.692 18.548 153.428 18.836 154.025 19.412C154.622 19.9667 154.921 20.7027 154.921 21.62C154.921 22.5373 154.622 23.2947 154.025 23.892C153.428 24.468 152.692 24.756 151.817 24.756Z"
            fill="black" />
        </svg>

      </router-link>

      <nav v-if="!userId">
        <router-link to="/about" class="btn tertiary">
          <UserGroupIcon class="icon" />
          <span>About us</span>
        </router-link>
      </nav>
      
      <nav v-if="userId">
        <router-link to="/leaderboard" class="btn tertiary" id="lb-btn">
          <FireIcon class="icon" />
          <span>View leaderboard</span>
        </router-link>
        <router-link to="/me" class="btn secondary">
          <UserCircleIcon class="icon" />
          <span>{{ firstName }}</span>
        </router-link>
        <button @click="logout" class="btn secondary">
          <ArrowLeftEndOnRectangleIcon class="icon" />
        </button>
      </nav>
    </header>

    <router-view></router-view>
  </div>
</template>

<style scoped>
.logo{
  @media screen and (max-width: 968px) {
       svg{
        display: none;
       } 

       &::after{
        content: "P.";
        font-size: 24px;
        font-weight: 700;
       }
  }
}
</style>
